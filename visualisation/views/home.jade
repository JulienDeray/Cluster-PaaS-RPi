html
  head
    title=title
    link(href='//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css', rel='stylesheet')
  body
    div.container
      div.jumbotron
        h1 Cluster informations

      table.table.table-striped
        thead
            tr
                th IP
                th Name
                th Port
        tbody#nodes

    script(src='/socket.io/socket.io.js')
    script(src='http://code.jquery.com/jquery-2.1.4.min.js')
    script(type='text/javascript').
        var socket = io.connect("#{ip}:8080");

        function updatePeerInfos(peerInfos) {
            console.log('new peer informations received', JSON.stringify(peerInfos));

            var peer_tr = $('#' + peerInfos.name);
            if ( peer_tr.length > 0 ) {
                peer_tr.find('.ip').first().html(peerInfos.ip);
                peer_tr.find('.port').first().html(peerInfos.port);
                peer_tr.find('.name').first().html(peerInfos.name);
            }
            else {
                $('#nodes').append(
                        '<tr id="' + peerInfos.name + '">' +
                        '<td class="ip">' + peerInfos.ip + '</td>' +
                        '<td class="port">' + peerInfos.port + '</td>' +
                        '<td class="name">' + peerInfos.name + '</td>' +
                        '</tr>'
                );
            }
        }

        socket.on('new_peer', function(peerInfos) {
            updatePeerInfos(peerInfos);
        });

        socket.on('update', function(peerInfos) {
            updatePeerInfos(peerInfos);
        });